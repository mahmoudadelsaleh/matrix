<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø§Ø¯Ù„ - Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµØ­ÙŠØ­</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
    <link rel="apple-touch-icon" href="icon-180x180.png">
    
    <meta name="theme-color" content="#2c3e50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root { --primary: #2c3e50; --accent: #2980b9; --active: #fff9c4; --success: #27ae60; --warning: #e67e22; --random: #8e44ad; --gold: #ffd700; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ø­Ø¨ Ø¨Ø¥ØµØ¨Ø¹ ÙˆØ§Ø­Ø¯ Ø¯ÙˆÙ† ØªØ¬Ù…ÙŠØ¯ */
        html, body { 
            overscroll-behavior-y: contain; 
            overflow-x: hidden; 
            height: auto; 
            min-height: 100%; 
            background: #f4f7f6;
            touch-action: manipulation; /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø­Ø±ÙƒØ© Ø³Ù„Ø³Ø© ÙˆÙ…Ù†Ø¹ Ø²ÙˆÙ… */
        }

        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 5px 5px 80px 5px; display: flex; flex-direction: column; align-items: center; user-select: none; }
        
        .marquee-container {
            width: 100%; max-width: 500px; background: #1a1a1a; 
            padding: 2px; border-radius: 20px; margin-bottom: 5px;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5); 
            overflow: hidden; border: 1px solid var(--gold);
        }

        .marquee-container marquee {
            direction: ltr; color: var(--gold); font-size: 14px; font-weight: bold;
            height: 20px; line-height: 20px; text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
        }

        .container { width: 100%; max-width: 500px; background: #fff; padding: 10px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }

        .system-layout { 
            display: flex; justify-content: center; align-items: center; 
            gap: 2px; margin-bottom: 10px; padding: 10px 0;
            background: #fafafa; border-radius: 10px; min-height: 150px;
        }

        .matrix-unit { display: flex; flex-direction: column; align-items: center; }
        .matrix-label { font-weight: bold; font-size: 13px; color: var(--primary); margin-bottom: 2px; }
        .math-symbol { font-size: 18px; font-weight: bold; color: var(--warning); display: flex; align-items: center; justify-content: center; height: 100%; padding-top: 30px; }

        .brackets { 
            display: flex; align-items: center; 
            padding: 2px 4px; border-left: 2.5px solid var(--primary); 
            border-right: 2.5px solid var(--primary); border-radius: 12px / 8px; background: #fff;
        }
        .det-mode { border-radius: 0 !important; border-width: 3px !important; }

        .dim-controls { display: flex; gap: 2px; margin-bottom: 4px; font-size: 9px; font-weight: bold; }
        .dim-btn { width: 22px; height: 22px; cursor: pointer; border: 1px solid #ccc; background: #fff; border-radius: 3px; font-size: 12px; display: flex; align-items: center; justify-content: center; }

        .grid { display: grid; gap: 2px; }
        .cell { width: 38px; height: 32px; text-align: center; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; outline: none; }
        .cell.readonly { background: #eee; cursor: default; color: #7f8c8d; }
        .cell.active { background: var(--active) !important; border: 2px solid var(--accent); }

        .numpad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; background: #34495e; padding: 8px; border-radius: 10px; margin-bottom: 10px; }
        .numpad button { height: 42px; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; background: #ecf0f1; box-shadow: 0 2px 0 #bdc3c7; }
        .btn-next { background: #3498db !important; color: white; }
        .btn-del { background: #e74c3c !important; color: white; }

        .ops-panel { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: 100%; }
        .op-btn { padding: 10px 2px; font-size: 11px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 3px 0 #1a252f; }
        .op-btn.special { background: var(--warning); }

        #result-area { margin-top: 10px; padding: 10px; border-top: 1px solid #eee; text-align: center; width: 100%; min-height: 80px; }
        
        .fraction-wrap { display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; }
        .frac { display: flex; flex-direction: column; align-items: center; padding: 0 4px; }
        .frac-num { border-bottom: 2px solid #000; padding: 0 3px; margin-bottom: 2px; }
        
        #inst-btn { display: none; position: fixed; top: 10px; left: 10px; width: 40px; height: 40px; background: var(--success); border-radius: 50%; border: none; z-index: 1000; color: white; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); align-items: center; justify-content: center; font-size: 20px; }

        .whatsapp-float {
            position: fixed; bottom: 15px; left: 15px; background: #25d366; color: white;
            width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 30px; box-shadow: 2px 2px 10px rgba(0,0,0,0.3); z-index: 100;
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <button id="inst-btn" title="ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚">ğŸ“¥</button>

    <div class="marquee-container">
        <marquee scrollamount="10" direction="right">Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø§Ø¯Ù„ ØµØ§Ù„Ø­ - El Mahmoudia - Ø±ÙŠØ§Ø¶ÙŠØ§Øª ØªÙØ§Ø¹Ù„ÙŠØ© - Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ØµÙÙˆÙØ§Øª Ø§Ù„Ø¬Ø¨Ø§Ø±Ø© - Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø§Ø¯Ù„ ØµØ§Ù„Ø­</marquee>
    </div>

    <div class="container">
        <div class="system-layout" id="main-display">
            <div class="matrix-unit" id="unitA">
                <div class="dim-controls" id="dimA">
                    Øµ <button class="dim-btn" onclick="resize('A','r',1)">+</button> <button class="dim-btn" onclick="resize('A','r',-1)">-</button>
                    Ø¹ <button class="dim-btn" onclick="resize('A','c',1)">+</button> <button class="dim-btn" onclick="resize('A','c',-1)">-</button>
                </div>
                <span class="matrix-label" id="labelA">Ø£</span>
                <div class="brackets" id="bracketA"><div id="gridA" class="grid"></div></div>
            </div>

            <div id="unknowns-section" style="display:none; align-items: center; gap: 2px;">
                <div class="math-symbol">Ã—</div>
                <div class="matrix-unit">
                    <span class="matrix-label" style="margin-top: 25px;">Ø³</span>
                    <div class="brackets"><div id="gridX" class="grid"></div></div>
                </div>
                <div class="math-symbol">=</div>
            </div>

            <div class="matrix-unit" id="unitB">
                <div class="dim-controls" id="dimB">
                    Øµ <button class="dim-btn" onclick="resize('B','r',1)">+</button> <button class="dim-btn" onclick="resize('B','r',-1)">-</button>
                    Ø¹ <button class="dim-btn" onclick="resize('B','c',1)">+</button> <button class="dim-btn" onclick="resize('B','c',-1)">-</button>
                </div>
                <span class="matrix-label" id="labelB">Ø¨</span>
                <div class="brackets" id="bracketB"><div id="gridB" class="grid"></div></div>
            </div>
        </div>

        <div class="numpad">
            <button onclick="press('7')">Ù§</button><button onclick="press('8')">Ù¨</button><button onclick="press('9')">Ù©</button><button class="btn-del" onclick="clearCell()">Ù…Ø³Ø­</button>
            <button onclick="press('4')">Ù¤</button><button onclick="press('5')">Ù¥</button><button onclick="press('6')">Ù¦</button><button onclick="press('back')">âŒ«</button>
            <button onclick="press('1')">Ù¡</button><button onclick="press('2')">Ù¢</button><button onclick="press('3')">Ù£</button><button class="btn-next" onclick="moveNext()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
            <button onclick="press('0')">Ù </button><button onclick="press('-')">Ù€</button><button onclick="press('.')">Ù«</button><button style="background:var(--success); color:white" onclick="_rs()">ØªØµÙÙŠØ±</button>
        </div>

        <div class="ops-panel">
            <button class="op-btn" onclick="calc('add')">Ø£ + Ø¨</button>
            <button class="op-btn" onclick="calc('sub')">Ø£ - Ø¨</button>
            <button class="op-btn" onclick="calcMul()">Ø£ Ã— Ø¨</button>
            <button class="op-btn" onclick="calcDet('A')">Ù…Ø­Ø¯Ø¯ Ø£</button>
            <button class="op-btn" onclick="calcDet('B')">Ù…Ø­Ø¯Ø¯ Ø¨</button>
            <button class="op-btn" onclick="calcInv('A')">Ù…Ø¹ÙƒÙˆØ³ Ø£</button>
            <button class="op-btn" onclick="calcInv('B')">Ù…Ø¹ÙƒÙˆØ³ Ø¨</button>
            <button class="op-btn" onclick="showPowerGrid()">Ø£ ^ Ù†</button>
            <button class="op-btn special" onclick="showSystemSelector()">Ù†Ø¸Ø§Ù… AX=B</button>
            <button class="op-btn" style="background:#27ae60" onclick="prepareTriangle()">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø«Ù„Ø«</button>
            <button class="op-btn" style="background:#8e44ad" onclick="decompose()">ØªÙÙƒÙŠÙƒ S+Sk</button>
            <button class="op-btn random" onclick="fillRandom()">ØªÙˆÙ„ÙŠØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
        </div>
        <div id="result-area">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>
    </div>

    <a href="https://wa.me/201552402912" class="whatsapp-float" target="_blank">
        <svg viewBox="0 0 32 32" style="width:30px; fill:#fff;"><path d="M16 0c-8.837 0-16 7.163-16 16 0 2.825.737 5.48 2.025 7.788l-2.025 7.212 7.375-1.938c2.207 1.156 4.712 1.813 7.375 1.813 8.837 0 16-7.163 16-16s-7.163-16-16-16zm8.294 22.181c-.344.969-1.713 1.775-2.363 1.894-.65.119-1.294.225-3.531-.662-2.825-1.125-4.638-4-4.781-4.188-.138-.194-1.15-1.531-1.15-2.925 0-1.394.725-2.081 1-2.381.269-.3.594-.375.794-.375.194 0 .394.006.563.013.175.006.413-.069.644.494.238.563.813 1.981.881 2.125.069.138.113.3.019.488-.094.188-.138.306-.281.475-.144.175-.3.388-.431.519-.144.144-.3.3-.131.594.169.294.75 1.238 1.606 2.006.719.644 1.325.85 1.619.994.294.144.463.125.638-.075.175-.194.75-.875.95-1.175.194-.3.394-.25.663-.15s1.713.806 2.006.956c.3.15.5.225.575.356.075.131.075.769-.269 1.738z"/></svg>
    </a>

<script>
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
    let _iP; window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); _iP = e; document.getElementById('inst-btn').style.display='flex'; });
    document.getElementById('inst-btn').onclick = () => { if(_iP){ _iP.prompt(); _iP=null; document.getElementById('inst-btn').style.display='none'; }};

    let activeInput = null;
    let dims = { A: {r:2, c:2}, B: {r:2, c:2}, X: {r:2, c:1} };
    const toAr = n => String(n).replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]).replace("-", "Ù€");
    const toEn = s => s.replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d)).replace("Ù€", "-");

    function resize(id, type, delta) {
        let v = dims[id][type] + delta;
        if(v < 1 || v > 3) return;
        dims[id][type] = v;
        renderGrid(id); resetUIMode();
    }

    function renderGrid(id) {
        const g = document.getElementById('grid' + id);
        if(!g) return;
        g.style.gridTemplateColumns = `repeat(${dims[id].c}, 38px)`;
        g.innerHTML = '';
        for(let i=0; i<dims[id].r*dims[id].c; i++) g.innerHTML += `<input class="cell" type="text" value="Ù " readonly onclick="setActive(this)">`;
    }

    function setActive(el) {
        if(el.classList.contains('readonly')) return;
        document.querySelectorAll('.cell').forEach(c => c.classList.remove('active'));
        activeInput = el; activeInput.classList.add('active');
    }

    function press(v) {
        if(!activeInput) return;
        let cur = activeInput.value;
        if(v === 'back') activeInput.value = cur.length > 1 ? cur.slice(0, -1) : "Ù ";
        else if(v === '-') activeInput.value = cur.includes('Ù€') ? cur.replace('Ù€','') : 'Ù€' + (cur === "Ù " ? "" : cur);
        else {
            if (cur === "Ù ") activeInput.value = toAr(v);
            else if (cur === "Ù€" || cur === "Ù€Ù ") activeInput.value = "Ù€" + toAr(v);
            else activeInput.value += toAr(v);
        }
    }

    function fillRandom() {
        let isTri = document.getElementById('labelA').innerText.includes("Ù…Ø³Ø§Ø­Ø©");
        document.querySelectorAll(`#gridA input, #gridB input`).forEach((input, idx) => {
            if(input.classList.contains('readonly')) return;
            if(isTri && idx % 3 === 0) return; 
            input.value = toAr(Math.floor(Math.random() * 19) - 9);
        });
    }

    function showSystemSelector() {
        document.getElementById('result-area').innerHTML = `
            <b>Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù‡ÙŠÙ„:</b><br>
            <button class="op-btn" style="width:80px; background:var(--accent); margin:5px;" onclick="prepareSystem(2)">Ù¢ (Ø³ØŒ Øµ)</button>
            <button class="op-btn" style="width:80px; background:var(--accent); margin:5px;" onclick="prepareSystem(3)">Ù£ (Ø³ØŒ ØµØŒ Ø¹)</button>
        `;
    }

    function prepareSystem(n) {
        dims.A = {r:n, c:n}; dims.B = {r:n, c:1}; dims.X = {r:n, c:1};
        renderGrid('A'); renderGrid('B');
        document.getElementById('dimA').style.visibility = 'hidden';
        document.getElementById('dimB').style.visibility = 'hidden';
        document.getElementById('unknowns-section').style.display = 'flex';
        const gx = document.getElementById('gridX');
        const ux = n === 2 ? ['Ø³', 'Øµ'] : ['Ø³', 'Øµ', 'Ø¹'];
        gx.style.gridTemplateColumns = '38px';
        gx.innerHTML = ux.map(u => `<input class="cell readonly" type="text" value="${u}" readonly>`).join('');
        document.getElementById('result-area').innerHTML = `<button class="op-btn special" style="width:120px" onclick="execSystem()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø­Ù„</button>`;
    }

    function execSystem() {
        let a = getM('A'), b = getM('B');
        let resA = getAdjAndDet(a);
        if(resA.det === 0) { alert("Ø§Ù„Ù…Ø­Ø¯Ø¯ ØµÙØ±"); return; }
        let adjB = matrixMul(resA.adj, b);
        let ux = a.length === 2 ? ['Ø³', 'Øµ'] : ['Ø³', 'Øµ', 'Ø¹'];
        let h = `<div style="display:flex; justify-content:center; align-items:center; gap:5px;">`;
        h += `<div class="brackets"><div class="grid">` + ux.map(u => `<input class="cell readonly" type="text" value="${u}" readonly>`).join('') + `</div></div><span>=</span>`;
        h += `<div class="fraction-wrap"><div class="frac"><span class="frac-num">Ù¡</span><span>${toAr(resA.det)}</span></div></div>` + renderStatic(adjB);
        document.getElementById('result-area').innerHTML = h;
    }

    function showPowerGrid() {
        let h = `<b>Ø§Ø®ØªØ± Ù† (Ù¡-Ù¡Ù Ù ):</b><div class="power-grid">`;
        for(let i=1; i<=100; i++) h += `<button class="p-btn" onclick="execPower(${i})">${toAr(i)}</button>`;
        document.getElementById('result-area').innerHTML = h + `</div>`;
    }

    function execPower(n) {
        let m = getM('A'); if(dims.A.r !== dims.A.c) { alert("ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø±Ø¨Ø¹Ø©"); return; }
        let res = m; for(let i=1; i<n; i++) res = matrixMul(res, m);
        showSimpleR(res, `Ø£ ^ ${toAr(n)}`);
    }

    function prepareTriangle() {
        resetUIMode(); document.getElementById('unitB').style.display = 'none';
        dims.A = {r:3, c:3}; renderGrid('A');
        document.getElementById('bracketA').classList.add('det-mode');
        document.getElementById('dimA').style.visibility = 'hidden';
        document.getElementById('labelA').innerText = "Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø«Ù„Ø«";
        let cells = document.querySelectorAll('#gridA input');
        for(let i=0; i<3; i++) { cells[i*3].value = "Ù¡"; cells[i*3].classList.add('readonly'); }
        document.getElementById('result-area').innerHTML = `
            <div style="display:flex; align-items:center; justify-content:center; gap:5px;">
                <div class="fraction-wrap"><div class="frac"><span class="frac-num">Ù¡</span><span>Ù¢</span></div></div><span style="font-size:24px; font-weight:bold;"> | Î” | </span>
            </div>
            <button class="op-btn" style="background:var(--success); margin-top:5px" onclick="execTriangle()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø©</button>`;
    }

    function execTriangle() {
        let m = getM('A');
        let det = (m[0][0]*(m[1][1]*m[2][2]-m[1][2]*m[2][1])) - (m[0][1]*(m[1][0]*m[2][2]-m[1][2]*m[2][0])) + (m[0][2]*(m[1][0]*m[2][1]-m[1][1]*m[2][0]));
        document.getElementById('result-area').innerHTML += `<div style="font-weight:bold; margin-top:5px;">Ø§Ù„Ù…Ø³Ø§Ø­Ø© = ${toAr(Math.abs(det)/2)} ÙˆØ­Ø¯Ø© Ù…Ø±Ø¨Ø¹Ø©</div>`;
    }

    function decompose() {
        let a = getM('A'); if(a.length !== a[0].length) { alert("ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø±Ø¨Ø¹Ø©"); return; }
        let mt = a[0].map((_, c) => a.map(r => r[c]));
        let sym = a.map((r, i) => r.map((v, j) => (v + mt[i][j]) / 2));
        let skw = a.map((r, i) => r.map((v, j) => (v - mt[i][j]) / 2));
        document.getElementById('result-area').innerHTML = `<b>Ø§Ù„ØªÙÙƒÙŠÙƒ</b><div style="display:flex; justify-content:center; align-items:center; gap:5px; margin-top:5px;">` + renderStatic(sym) + ` + ` + renderStatic(skw) + `</div>`;
    }

    function resetUIMode() {
        document.getElementById('unknowns-section').style.display = 'none';
        document.getElementById('unitB').style.display = 'flex';
        document.getElementById('dimA').style.visibility = 'visible';
        document.getElementById('dimB').style.visibility = 'visible';
        document.getElementById('bracketA').classList.remove('det-mode');
        document.getElementById('labelA').innerText = "Ø£";
        document.getElementById('result-area').innerHTML = "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...";
    }
    function _rs() { resetUIMode(); dims={A:{r:2,c:2},B:{r:2,c:2}}; renderGrid('A'); renderGrid('B'); }

    function getM(id) {
        let cells = document.querySelectorAll(`#grid${id} input`);
        let r = dims[id].r, c = dims[id].c, m = [];
        for(let i=0; i<r; i++) { m[i] = []; for(let j=0; j<c; j++) m[i][j] = parseFloat(toEn(cells[i*c+j].value)) || 0; }
        return m;
    }

    function matrixMul(m1, m2) {
        let res = Array(m1.length).fill(0).map(() => Array(m2[0].length).fill(0));
        for(let i=0; i<m1.length; i++) for(let j=0; j<m2[0].length; j++) for(let k=0; k<m1[0].length; k++) res[i][j] += m1[i][k] * m2[k][j];
        return res;
    }

    function getAdjAndDet(m) {
        let n = m.length;
        let det = (n===1)?m[0][0]:(n===2)?(m[0][0]*m[1][1]-m[0][1]*m[1][0]):(m[0][0]*(m[1][1]*m[2][2]-m[1][2]*m[2][1])-m[0][1]*(m[1][0]*m[2][2]-m[1][2]*m[2][0])+m[0][2]*(m[1][0]*m[2][1]-m[1][1]*m[2][0]));
        let aj = (n===1)?[[1]]:(n===2)?[[m[1][1], -m[0][1]], [-m[1][0], m[0][0]]]:[
            [(m[1][1]*m[2][2]-m[1][2]*m[2][1]), -(m[0][1]*m[2][2]-m[0][2]*m[2][1]), (m[0][1]*m[1][2]-m[0][2]*m[1][1])],
            [-(m[1][0]*m[2][2]-m[1][2]*m[2][0]), (m[0][0]*m[2][2]-m[0][2]*m[2][0]), -(m[0][0]*m[1][2]-m[0][2]*m[1][0])],
            [(m[1][0]*m[2][1]-m[1][1]*m[2][0]), -(m[0][0]*m[2][1]-m[0][1]*m[2][0]), (m[0][0]*m[1][1]-m[0][1]*m[1][0])]
        ];
        return {adj:aj, det:det};
    }

    function renderStatic(m) {
        let h = `<div class="brackets"><div class="grid" style="grid-template-columns: repeat(${m[0].length}, 38px)">`;
        m.forEach(r => r.forEach(v => h += `<input class="cell readonly" type="text" value="${toAr(Number.isInteger(v)?v:v.toFixed(1))}" readonly>`));
        return h + `</div></div>`;
    }

    function moveNext() {
        let all = Array.from(document.querySelectorAll('.cell:not(.readonly)'));
        let idx = all.indexOf(activeInput);
        if(idx < all.length - 1) setActive(all[idx+1]);
    }

    function clearCell() { if(activeInput) activeInput.value = "Ù "; }
    function calc(t) { let a = getM('A'), b = getM('B'); if(dims.A.r!==dims.B.r || dims.A.c!==dims.B.c){alert("Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©"); return;} showSimpleR(a.map((r,i)=>r.map((v,j)=>t==='add'?v+b[i][j]:v-b[i][j])), t==='add'?"Ø£ + Ø¨":"Ø£ - Ø¨"); }
    function calcMul() { let a = getM('A'), b = getM('B'); if(a[0].length !== b.length) {alert("Ø£Ø¹Ù…Ø¯Ø© Ø£ â‰  ØµÙÙˆÙ Ø¨"); return;} showSimpleR(matrixMul(a,b), "Ø£ Ã— Ø¨"); }
    function calcDet(id) { let res = getAdjAndDet(getM(id)); document.getElementById('result-area').innerHTML = `<b>Ù…Ø­Ø¯Ø¯ ${id} = ${toAr(res.det)}</b>`; }
    function calcInv(id) { let res = getAdjAndDet(getM(id)); if(res.det===0){alert("Ø§Ù„Ù…Ø­Ø¯Ø¯ ØµÙØ±"); return;} showSimpleR(res.adj, "Ù…Ø¹ÙƒÙˆØ³ "+id, res.det); }
    function showSimpleR(m, txt, det=null) { document.getElementById('result-area').innerHTML = `<b>${txt}</b><div style="display:flex; justify-content:center; align-items:center; gap:5px; margin-top:8px;">` + (det?`<div class="fraction-wrap"><div class="frac"><span class="frac-num">Ù¡</span><span>${toAr(det)}</span></div></div>`:"") + renderStatic(m) + `</div>`; }

    renderGrid('A'); renderGrid('B');
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Matrix Pro - M.A.S</title>
    <style>
        :root { --p: #2c3e50; --a: #2980b9; --s: #27ae60; --w: #e67e22; --gold: #f1c40f; --red: #e74c3c; --gray-panel: #e0e4e8; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        html, body { height: 100vh; width: 100vw; overflow: hidden; overscroll-behavior: contain; background: #000; font-family: sans-serif; display: flex; justify-content: center; }
        
        .main-app { 
            width: 100%; max-width: 500px; height: 100%; background: #fff; border: 3px solid var(--p); 
            display: flex; flex-direction: column; position: relative; padding-top: 0.6cm;
        }
        
        /* ضبط منطقة المصفوفات لتكون العناوين واضحة */
        .sec-matrices { height: 18vh; display: flex; justify-content: center; align-items: center; gap: 10px; background: #fff; padding-bottom: 5px; }
        .u-t { display: flex; flex-direction: column; align-items: center; }
        .b-k { 
            display: flex; align-items: center; padding: 4px; border-left: 5.5px solid var(--p); border-right: 5.5px solid var(--p); 
            border-radius: 14px / 12px; background: #fff; min-height: 70px; justify-content: center;
        }
        .det-style { border-radius: 0 !important; border-width: 0 5.5px !important; }
        .g-d { display: grid; gap: 4px; }
        .c-l { width: 35px; height: 32px; text-align: center; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; font-weight: bold; }
        .c-l.at { background: #fff9c4 !important; border: 2.5px solid var(--a); }
        .c-l.ro { background: #f1f2f6; color: #999; }

        /* لوحة المفاتيح: تم إزاحتها لأسفل قليلاً لتلتصق بالعمليات */
        .numpad-container { margin: 15px 10px 2px; background: #222; padding: 8px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .sec-numpad { display: grid; grid-template-columns: 1fr 1fr 1fr 1.5fr; grid-template-rows: repeat(4, 1fr); gap: 5px; height: 24vh; }
        .sec-numpad button { 
            border: none; border-radius: 6px; font-size: 19px; font-weight: bold; background: #333; color: #fff; 
            box-shadow: 0 4px 0 #000; cursor: pointer; transition: 0.1s;
        }
        .sec-numpad button:active { transform: translateY(3px); box-shadow: 0 1px 0 #000; }

        /* لوحة العمليات: ملتصقة تقريباً بلوحة الأرقام */
        .ops-panel { margin: 2px 10px 5px; padding: 8px; background: var(--gray-panel); border-radius: 12px; border: 1px solid #bdc3c7; }
        .sec-ops-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .o-b { border: none; border-radius: 6px; font-size: 10px; font-weight: bold; height: 36px; color: #fff; cursor: pointer; box-shadow: 0 2px 3px rgba(0,0,0,0.2); }
        
        .btn-add { background: var(--s); }
        .btn-mul { background: var(--a); }
        .btn-det { background: var(--red); }
        .btn-pow { background: var(--w); }
        .btn-inv { background: #8e44ad; }
        .btn-special { background: var(--p); }

        .f-c { display: inline-flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; margin: 0 4px; vertical-align: middle; font-size: 14px; }
        .f-n { border-bottom: 2px solid #000; padding: 0 2px; }

        .sec-res { flex: 1; padding: 8px; overflow-y: auto; background: #fff; border-top: 2.5px solid var(--a); text-align: center; }
        .res-row { display: flex; align-items: center; justify-content: center; gap: 4px; margin-top: 8px; }
        .dim-btn { background: var(--p); color: white; border: none; padding: 2px 8px; font-size: 10px; border-radius: 4px; margin: 2px; }
        
        .m-wrap { position: absolute; bottom: 0; width: 100%; background: var(--gold); height: 32px; display: flex; align-items: center; border-top: 1px solid #000; overflow: hidden; }
        .m-wrap marquee { color: #000; font-size: 13px; font-weight: bold; line-height: 32px; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="main-app">
    <div class="sec-matrices">
        <div class="u-t">
            <div id="_ctrlA"><button class="dim-btn" onclick="_fH(7,'A','r')">صف</button><button class="dim-btn" onclick="_fH(7,'A','c')">عمود</button></div>
            <div style="display:flex; align-items:center;">
                <div id="_areaFrac" style="display:none;" class="f-c"><span class="f-n">١</span><span>٢</span></div>
                <div class="b-k" id="_brkA"><div id="_grA" class="g-d"></div></div>
            </div>
            <span id="_lblA" style="font-size:11px; font-weight:bold; margin-top:3px;">مصفوفة أ</span>
        </div>
        
        <div id="_uSys" style="display:none; align-items:center; font-weight:bold; color:var(--w); font-size: 20px; gap: 10px;">
            <span>×</span>
            <div class="u-t"><div class="b-k"><div id="_grX" class="g-d" style="grid-template-columns: 35px;"></div></div><span style="font-size:10px;">س</span></div>
            <span>=</span>
        </div>

        <div class="u-t" id="_uB">
            <div id="_ctrlB"><button class="dim-btn" onclick="_fH(7,'B','r')">صف</button><button class="dim-btn" onclick="_fH(7,'B','c')">عمود</button></div>
            <div class="b-k" id="_brkB"><div id="_grB" class="g-d"></div></div>
            <span id="_lblB" style="font-size:11px; font-weight:bold; margin-top:3px;">مصفوفة ب</span>
        </div>
    </div>

    <div class="numpad-container">
        <div class="sec-numpad">
            <button onclick="_fH(3,'7')">٧</button><button onclick="_fH(3,'8')">٨</button><button onclick="_fH(3,'9')">٩</button><button style="background:var(--w)!important" onclick="_fH(5)">مسح</button>
            <button onclick="_fH(3,'4')">٤</button><button onclick="_fH(3,'5')">٥</button><button onclick="_fH(3,'6')">٦</button><button style="background:#555!important" onclick="_fH(3,'back')">حذف ⌫</button>
            <button onclick="_fH(3,'1')">١</button><button onclick="_fH(3,'2')">٢</button><button onclick="_fH(3,'3')">٣</button><button style="background:var(--a)!important" onclick="_fH(4)">التالي</button>
            <button onclick="_fH(3,'0')">٠</button><button onclick="_fH(3,'-')">ـ</button><button onclick="_fH(3,'.')">٫</button><button style="background:var(--red)!important" onclick="location.reload()">إعادة</button>
        </div>
    </div>

    <div class="ops-panel">
        <div class="sec-ops-grid" style="grid-template-rows: 1fr 1fr; margin-bottom: 5px;">
            <button class="o-b btn-add" onclick="_oK(1)">أ + ب</button>
            <button class="o-b btn-mul" onclick="_oK(3)">أ × ب</button>
            <button class="o-b btn-inv" onclick="_oK(6)">معكوس أ</button>
            <button class="o-b btn-pow" onclick="_oK(8)">أ ^ ن</button>
            <button class="o-b btn-det" onclick="_oK(4)">محدد أ</button>
            
            <button class="o-b btn-add" onclick="_oK(2)">أ - ب</button>
            <button class="o-b btn-mul" onclick="_oK(13)">ب × أ</button>
            <button class="o-b btn-inv" onclick="_oK(7)">معكوس ب</button>
            <button class="o-b btn-pow" onclick="_oK(14)">ب ^ ن</button>
            <button class="o-b btn-det" onclick="_oK(5)">محدد ب</button>
        </div>
        <div class="sec-ops-grid">
            <button class="o-b btn-special" onclick="_oK(9)">حل النظام</button>
            <button class="o-b btn-add" style="background:var(--s)" onclick="_oK(10)">المساحة</button>
            <button class="o-b btn-inv" onclick="_oK(11)">تفكيك</button>
            <button class="o-b btn-det" onclick="_oK(12)">عشوائي</button>
            <button class="o-b btn-mul" onclick="toggleFS()">ملء الشاشة</button>
        </div>
    </div>

    <div class="sec-res" id="res"></div>

    <div class="m-wrap">
        <marquee direction="right" scrollamount="5">محمود عادل صالح &nbsp;&nbsp; | &nbsp;&nbsp; رياضيات تفاعلية - Matrix Pro &nbsp;&nbsp; | &nbsp;&nbsp; واتساب: 201552402912+ &nbsp;&nbsp; | &nbsp;&nbsp; محمود عادل صالح</marquee>
    </div>
</div>

<script>
(function(){
    var _0xM = null, _0xD = {A:{r:2,c:2},B:{r:2,c:2},X:{r:2,c:1}}, _0xP = false, _targetPow = 'A', _isAreaMode = false;
    const _0xT = n => String(n).replace(/\d/g, d => "٠١٢٣٤٥٦٧٨٩"[d]).replace("-", "ـ");
    const _0xE = s => s.replace(/[٠-٩]/g, d => "٠١٢٣٤٥٦٧٨٩".indexOf(d)).replace("ـ", "-");

    window.toggleFS = function() { var el = document.documentElement; if (!document.fullscreenElement) el.requestFullscreen().catch(()=>{}); else document.exitFullscreen(); };

    window._fH = function(n, a, b) {
        if(n===7){ _0xD[a][b] = _0xD[a][b] === 3 ? 1 : _0xD[a][b] + 1; _rG(a); _rs(); }
        if(n===3){ if(!_0xM)return; if(_0xP){_0xM.value=_0xT(a); _0xP=false; return;} var v=_0xM.value; if(a==='back') _0xM.value=v.length>1?v.slice(0,-1):"٠"; else if(a==='-') _0xM.value=v.includes('ـ')?_0xM.value.replace('ـ',''):'ـ'+(v==="٠"?"":v); else _0xM.value=(v==="٠"?_0xT(a):v+_0xT(a)); }
        if(n===4){ var l=Array.from(document.querySelectorAll('.c-l:not(.ro)')); var i=l.indexOf(_0xM); if(i<l.length-1)_sA(l[i+1]); }
        if(n===5){ if(_0xM && !_0xM.classList.contains('ro'))_0xM.value="٠"; }
    };

    const _rG = function(i) {
        var g=document.getElementById('_gr'+i); g.style.gridTemplateColumns=`repeat(${_0xD[i].c}, 35px)`; g.innerHTML='';
        for(var k=0; k<_0xD[i].r*_0xD[i].c; k++) g.innerHTML+='<input class="c-l" type="text" value="٠" readonly onclick="_sA(this)">';
        if(i==='A' && _isAreaMode) { var cl=document.querySelectorAll('#_grA input'); for(var d=0;d<3;d++){ cl[3*d].value="١"; cl[3*d].classList.add('ro'); } }
    };

    window._sA = function(e) { if(e.classList.contains('ro')) return; document.querySelectorAll('.c-l').forEach(c=>c.classList.remove('at')); _0xM=e; _0xM.classList.add('at'); };

    window._oK = function(n) {
        var a=_gM('A'), b=_gM('B');
        if(n!==12) _clearResOnly(); 
        if(n===1||n===2) { if(_0xD.A.r!==_0xD.B.r||_0xD.A.c!==_0xD.B.c) return; _sR(a.map((r,i)=>r.map((v,j)=>n===1?v+b[i][j]:v-b[i][j])), n===1?"أ+ب":"أ-ب"); }
        else if(n===3) { if(a[0].length!==b.length) return; _sR(_mu(a,b),"أ×ب"); }
        else if(n===13) { if(b[0].length!==a.length) return; _sR(_mu(b,a),"ب×أ"); }
        else if(n===4||n===5) { var r=_adD(n===4?a:b); document.getElementById('res').innerHTML="<b>المحدد = "+_0xT(r.det)+"</b>"; }
        else if(n===6||n===7) { var r=_adD(n===6?a:b); if(r.det!==0) _sR(r.adj,"المعكوس",r.det); }
        else if(n===8||n===14) { _targetPow=(n===8?'A':'B'); _0xP=true; document.getElementById('res').innerHTML='<b>أس ن لـ '+_targetPow+':</b><br><input class="c-l at" style="width:60px" id="_powV" value="٢" readonly onclick="_sA(this)"><br><button class="dim-btn" onclick="_eP()" style="margin-top:5px; padding:5px 15px;">احسب</button>'; _0xM=document.getElementById('_powV'); }
        else if(n===9) { _clearAllStates(); document.getElementById('res').innerHTML='<b>اختر عدد المجاهيل:</b><br><button class="dim-btn" style="padding:8px" onclick="_setS(2)">٢ (س،ص)</button> <button class="dim-btn" style="padding:8px" onclick="_setS(3)">٣ (س،ص،ع)</button>'; }
        else if(n===10) { _clearAllStates(); _isAreaMode = true; _eT_Mode(); }
        else if(n===11) { 
            if(a.length !== a[0].length) return;
            var at=_tp(a); 
            var sym = a.map((r,i)=>r.map((v,j)=>(v+at[i][j]))); 
            var skew = a.map((r,i)=>r.map((v,j)=>(v-at[i][j]))); 
            _sR(sym, "تفكيك (متماثلة + غير متماثلة)", 2, " + ", skew, 2);
        }
        else if(n===12) { _doRandom(); }
    };

    window._doRandom = function() {
        var clA=document.querySelectorAll('#_grA input'), clB=document.querySelectorAll('#_grB input');
        clA.forEach((el, idx) => { if (el.classList.contains('ro')) return; if (_isAreaMode && idx % 3 === 0) return; el.value = _0xT(Math.floor(Math.random()*19)-9); });
        clB.forEach(el => { if (el.classList.contains('ro')) return; el.value = _0xT(Math.floor(Math.random()*19)-9); });
    };

    window._setS = function(n) {
        _0xD.A={r:n,c:n}; _0xD.B={r:n,c:1}; _rG('A'); _rG('B'); 
        document.getElementById('_ctrlA').style.display='none'; document.getElementById('_ctrlB').style.display='none';
        document.getElementById('_uSys').style.display='flex';
        var gx=document.getElementById('_grX');
        gx.innerHTML=(n===2?['س','ص']:['س','ص','ع']).map(u=>'<input class="c-l ro" value="'+u+'" readonly>').join('');
        document.getElementById('res').innerHTML='<button class="dim-btn" style="padding:10px" onclick="_eS()">حل النظام الآن</button>';
    };

    window._eS = function() {
        var a=_gM('A'), b=_gM('B'), r=_adD(a); if(r.det===0) return;
        var ajB=_mu(r.adj,b), ux=a.length===2?['س','ص']:['س','ص','ع'];
        var h='<div class="res-row"><div class="b-k"><div class="g-d" style="grid-template-columns:35px">'+ux.map(u=>'<input class="c-l ro" value="'+u+'" readonly>').join('')+'</div></div><b>=</b>'+_rS(ajB, r.det)+'</div>';
        document.getElementById('res').innerHTML=h;
    };

    window._eT_Mode = function() {
        _0xD.A={r:3,c:3}; _rG('A'); 
        document.getElementById('_ctrlA').style.display='none'; document.getElementById('_ctrlB').style.display='none';
        document.getElementById('_brkA').classList.add('det-style'); 
        document.getElementById('_areaFrac').style.display='flex';
        document.getElementById('_lblA').innerText = "محدد المساحة";
        document.getElementById('_uB').style.display='none'; 
        document.getElementById('res').innerHTML='<button class="dim-btn" style="padding:10px" onclick="_eT()">احسب المساحة</button>';
    };

    window._eT = function() { var a=_gM('A'), d=_adD(a).det; document.getElementById('res').innerHTML="<b>المساحة = "+_0xT(Math.abs(d)/2)+" وحدة مربعة</b>"; };
    
    window._eP = function() { 
        var n = parseInt(_0xE(document.getElementById('_powV').value)) || 1;
        var a = _gM(_targetPow); if(a.length === a[0].length){ var b = a; for(var i=1; i<n; i++) b = _mu(b, a); _sR(b, _targetPow + " ^ " + _0xT(n)); } 
    };

    const _gM = i => { var cl=document.querySelectorAll('#_gr'+i+' input'), r=_0xD[i].r, c=_0xD[i].c, m=[]; for(var j=0; j<r; j++){ m[j]=[]; for(var k=0; k<c; k++) m[j][k]=parseFloat(_0xE(cl[j*c+k].value))||0; } return m; };
    const _mu = (m1,m2) => { var r=Array(m1.length).fill(0).map(()=>Array(m2[0].length).fill(0)); for(var i=0; i<m1.length; i++)for(var j=0; j<m2[0].length; j++)for(var k=0; k<m1[0].length; k++)r[i][j]+=m1[i][k]*m2[k][j]; return r; };
    const _tp = a => a[0].map((_,c)=>a.map(r=>r[c]));
    const _adD = m => {
        var n=m.length, d=1===n?m[0][0]:2===n?m[0][0]*m[1][1]-m[0][1]*m[1][0]:m[0][0]*(m[1][1]*m[2][2]-m[1][2]*m[2][1])-m[0][1]*(m[1][0]*m[2][2]-m[1][2]*m[2][0])+m[0][2]*(m[1][0]*m[2][1]-m[1][1]*m[2][0]);
        var aj=1===n?[[1]]:2===n?[[m[1][1],-m[0][1]],[-m[1][0],m[0][0]]]:[[m[1][1]*m[2][2]-m[1][2]*m[2][1],-(m[0][1]*m[2][2]-m[0][2]*m[2][1]),m[0][1]*m[1][2]-m[0][2]*m[1][1]],[-(m[1][0]*m[2][2]-m[1][2]*m[2][0]),m[0][0]*m[2][2]-m[0][2]*m[2][0],-(m[0][0]*m[1][2]-m[0][2]*m[1][0])],[m[1][0]*m[2][1]-m[1][1]*m[2][0],-(m[0][0]*m[2][1]-m[0][1]*m[2][0]),m[0][0]*m[1][1]-m[0][1]*m[1][0]]];
        return {adj:aj, det:d};
    };
    
    const _getFracHTML = (val) => {
        if(!val || val === 1) return '';
        let sign = val < 0 ? 'ـ' : '';
        let absVal = Math.abs(val);
        return `<div class="f-c"><span class="f-n">${sign}١</span><span>${_0xT(absVal)}</span></div>`;
    };

    const _rS = (m, dt=1, sep, m2, dt2=1) => {
        var h=_getFracHTML(dt)+'<div class="b-k"><div class="g-d" style="grid-template-columns:repeat('+m[0].length+', 35px)">';
        m.forEach(r=>r.forEach(v=>h+='<input class="c-l ro" value="'+_0xT(Number.isInteger(v)?v:v.toFixed(1))+'" readonly>')); h+='</div></div>';
        if(sep) h+= ' <b style="font-size:20px; margin: 0 4px;">'+sep+'</b> '+_rS(m2, dt2); return h;
    };
    const _sR = (m,t,dt,sep,m2,dt2) => { document.getElementById('res').innerHTML='<b>'+t+'</b><div class="res-row">'+_rS(m,dt,sep,m2,dt2)+'</div>'; };
    
    window._clearResOnly = () => { document.getElementById('res').innerHTML=''; };
    window._clearAllStates = () => {
        _isAreaMode = false;
        document.getElementById('_uSys').style.display='none'; 
        document.getElementById('_uB').style.display='flex'; 
        document.getElementById('_brkA').classList.remove('det-style'); 
        document.getElementById('_areaFrac').style.display='none';
        document.getElementById('_ctrlA').style.display='block';
        document.getElementById('_ctrlB').style.display='block';
        document.getElementById('_lblA').innerText="مصفوفة أ";
        document.getElementById('res').innerHTML=''; 
    };
    window._rs = () => { _clearAllStates(); _rG('A'); _rG('B'); };
    _rG('A'); _rG('B');
})();
</script>
</body>
</html>

